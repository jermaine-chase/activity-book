<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Word Search	</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js" integrity="sha256-gJWdmuCRBovJMD9D/TVdo4TIK8u5Sti11764sZT1DhI=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	<script src="assets/scripts/html2canvas.min.js"></script>

    <style>
		body {
			font-family: Cambria,Georgia,serif;
		}
        table {
            padding: 0px;
        }
        td {
            padding: 0px;
            text-align: center;
            font-size: 43.5px;
            width: 45.5px;
        }
		.admin {
			font-size: 21.75px;
		}
        tr {
            padding: 0px;
        }
        h1 {
            font-size: 64px;
            text-align: center;
			margin-bottom: 0px;
			margin-top: 0px;
			padding-bottom: 25px;
        }
        div {
            font-size: 43.5px;
            text-align: center;
        }
        thead {
            display: none;
        }
		textarea {
			width: 170px;
			height: 55px;
			resize: none;
		}
		.border {
			border: 1px solid black;
            width: 744px;
			height: 960px;
		}
		.footer {
			font-size: 26.1px;
			margin-top: 25px;
			width: 690px;
		}
		.padPageLeft {
			padding-top: 48px;
			padding-bottom: 48px;
			padding-left: 24px;
			padding-right: 36px;
			height: 960px;
		}
		.padPageRight {
			padding-top: 48px;
			padding-bottom: 48px;
			padding-left: 36px;
			padding-right: 24px;
			height: 960px;
		}
		.valignTop {
			vertical-align: top;
		}
		.valignMiddle {
			vertical-align: middle;
		}
		.valignBottom {
			vertical-align: bottom;
		}
		.inputDim {
			width: 24px;
		}
    </style>
</head>
<body>
	<table>
		<tr>
			<td class="border">
				<div id="output"></div>
			</td>
			<td class="admin">
				Title:&nbsp;<input id="title"/><br><br>
				Width: <input id="puzzleWidth" class="inputDim"/><br>Height: <input id="puzzleHeight" class="inputDim"/><br><br>
				Word List (comma separated):<br><textarea id="wordListIn" maxlength="60"></textarea><br><br>
				<select id = "pagePadSelector">
					<option value="Right">Right Page</option>
					<option value="Left">Left Page</option>
				</select><br>
				<button id="generateWordSearch">Generate Word Search</button>&nbsp;<button id="pdfPrint">Print PDF</button>
			</td>
		</tr>
	</table>
	<script>
		var width = 0;
		var height = 0;
		var positions;
		var columns = 15;
		var wordSearch;

		var createLine = function(arr, row, start, end) {
		   var tr = '';
		   for (var idx = start; idx < end; idx++) {
				tr += '<td>'+arr[idx][row]+'</td>';
		   }
		   
		   tr = '<tr>' + tr + '</tr>';
		   return tr;
		}

		var search = function(numbers, key) {
			for (var idx = 0; idx < numbers.length; idx++) {
				if (numbers[idx] === key) {
					return true; //found it
				}
			}
			return false;
		}

		var randomRange = function(min, max) {
			return Math.floor(Math.random() * (max - min) ) + min;
		}
		
		var doWork = function() {
			if (jQuery('#wordListIn').val().length > 0) {
				measurements();
				fill();
				out += '<table  align="center">';
				out += createLine(coded, 0, newLineIdx, coded.length);
				out += createLine(coded, 1, newLineIdx, coded.length);
				out += '</table></div><div id="key" class="footer valignBottom">'+footer+'</div></div>';
				jQuery('#output').html(out);
				var headerHeight = jQuery('#header').outerHeight();
				var bodyHeight = jQuery('#body').outerHeight();
				var keyHeight = jQuery('#key').outerHeight();
				var outputHeight = 962;
				var padSize = (outputHeight - (headerHeight + bodyHeight + keyHeight)) / 2;

				jQuery('#key').css('padding-top', padSize);
				jQuery('#body').css('padding-top', padSize);
				return;
			}
		}

		var getWordList = function() {
			var wordList = $('#wordListIn').val();
			return wordList.split(',');
		}

		var measurements = function () {
			var enteredWidth = jQuery('#puzzleWidth').val();
			var enteredHeight = jQuery('#puzzleHeight').val();
			var changed = false;
			
			var wordArray = getWordList();

			for (var i = 0; i < wordArray.length; i++) {
				if (wordArray[i].length > width) {
					width = wordArray[i].length;
				}
				if (wordArray[i].length > height) {
					height = wordArray[i].length;
				}
			}

			if (width < enteredWidth) {
				width = enteredWidth;
			}
			if (height < enteredHeight) {
				height = enteredHeight;
			}
			wordSearch = array2D(width, height);
		}

		var fill = function() {
			var between;
			var strlen;
			var x;
			var y;
			var wordArray = getWordList();

			positions = new Array(wordArray.length);

			for (var i = 0; i < wordArray.length; i++) {
				strlen = wordArray[i].length;
				between = width - strlen;
				x = randomRange(0, between);
				y = randomRange(0, height - 5)
				if (search(positions, y)) {
					y++;
				}
				positions[i] = y;
				for (var ind = 0; ind < strlen; ind++) { // for each letter in the word,
					wordSearch[x][y] = wordArray[i].charAt(ind); // put char into search array
					x++;
				}
			}
			//fill empty spaces
			for (var i = 0; i < length; i++) {
				for (var ind = 0; ind < width; ind++) {
					if (wordSearch[x][y] == 0) {
						var t = String.fromCharCode(randomRange(65, 90));
						wordSearch[ind][i] = t;
					}
				}
			}
		}

		var array2D = function(inWidth, inHeight) {
			var a2dArray = new Array(inWidth).fill(0);
			for (o of a2dArray) {
				o = new Array(inHeight).fill(0);
			}
			return a2dArray;
		}

		jQuery('#pdfPrint').click(
		function () {
			const filename  = 'Decoder.pdf';

			html2canvas(document.querySelector('#output'), {scale: 2}).then(canvas => {
				let pdf = new jsPDF('p', 'px', 'letter');
				pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 450, 590);
				pdf.save(filename);
			});
		});

		jQuery('#generateWordSearch').click(function() {doWork();});
	</script>
</body>
</html>